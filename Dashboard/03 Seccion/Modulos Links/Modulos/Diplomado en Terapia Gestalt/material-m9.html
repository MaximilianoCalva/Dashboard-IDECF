<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diplomado en Terapia Gestalt - Material M9</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: {
                        primary: '#233878',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 min-h-screen">
    
    <div id="page-loader" class="fixed inset-0 z-50 flex items-center justify-center bg-white">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-primary"></div>
    </div>

    <!-- HEADER -->
    <div class="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm">
        <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
            <div>
                <span class="text-xs font-bold text-primary tracking-widest uppercase mb-1 block">Recursos Descargables</span>
                <h1 class="text-2xl font-bold text-slate-900 leading-none">Diplomado en Terapia Gestalt</h1>
            </div>
            <div class="text-right hidden md:block">
                <p class="text-sm text-slate-500">Módulo 9</p>
            </div>
        </div>
    </div>

    <main id="main-content" class="max-w-5xl mx-auto px-6 py-10 opacity-0 transition-opacity duration-500">
        
        <div class="mb-4 text-sm breadcrumbs text-slate-400">
          <ul class="flex gap-2">
            <li><a href="#" onclick="history.back()" class="hover:text-primary">← Volver</a></li>
          </ul>
        </div>

        <div id="materialList" class="space-y-4">
            <!-- Injected Items -->
        </div>

        <footer class="mt-16 pt-8 border-t border-slate-200 text-center text-slate-400 text-sm">
            <p>&copy; 2026 IDECF. Todos los derechos reservados.</p>
        </footer>

    </main>

    <script>
        // HARDCODED CONFIGURATION - ANTI-CACHE
        const CACHE_KEY = `idecf_gestalt_m9_mat_cache`;
        const FETCH_URL = "https://script.google.com/macros/s/AKfycbxiaHxJ_MwB5x3LZy-vn8kbx1hcYVAYuQZobIB2RlyHC5as-s8nPfA5Fce3A6TAuppk/exec?type=material&course=gestalt&module=9";

        (async function init() {
            try {
                // 1. Local Cache
                const cached = localStorage.getItem(CACHE_KEY);
                let hasRendered = false;

                if (cached) {
                    try {
                        const parsed = JSON.parse(cached);
                        if (Date.now() - parsed.timestamp < 3600000 * 24) { // 24 Hours
                             console.log("Loading from cache:", CACHE_KEY);
                             processData(parsed.data);
                             hasRendered = true;
                             hideLoader();
                             // Fetch in background to update
                        }
                    } catch(e) { localStorage.removeItem(CACHE_KEY); }
                }

                // 2. Network Request (With Cache Buster)
                const finalUrl = FETCH_URL + "&t=" + Date.now();
                console.log("Fetching URL:", finalUrl);

                const response = await fetch(finalUrl);
                if(!response.ok) throw new Error("HTTP " + response.status);
                
                const data = await response.json();
                
                if (data.error) {
                     localStorage.removeItem(CACHE_KEY);
                     throw new Error(data.error);
                }

                // Update Cache
                localStorage.setItem(CACHE_KEY, JSON.stringify({ timestamp: Date.now(), data: data }));
                
                if (!hasRendered) {
                     processData(data);
                     hideLoader();
                }

            } catch (error) {
                console.error(error);
                
                // FORCE CLEAR CACHE
                localStorage.removeItem(CACHE_KEY);

                if (!document.querySelector('.doc-card')) {
                     hideLoader();
                     document.getElementById('materialList').innerHTML = `<div class="p-6 bg-red-50 text-red-600 rounded-xl text-center border border-red-100">
                        <p class="font-bold">Error de Carga</p>
                        <p class="text-sm mt-1 mb-2 font-mono text-xs text-left bg-red-50 p-2 rounded">
                            ${error.message}<br>
                             <span class="text-red-300">Target: ${FETCH_URL}</span>
                        </p>
                        <button onclick="location.reload(true)" class="mt-4 underline hover:text-red-800">Reintentar (Limpiar Cache)</button>
                     </div>`;
                }
            }
        })();

        function hideLoader() {
            document.getElementById('page-loader').classList.add('hidden');
            document.getElementById('main-content').classList.remove('opacity-0');
        }

        function processData(items) {
            const listEl = document.getElementById('materialList');
            
            if (items && items.length > 0) {
                listEl.innerHTML = "";
                items.forEach((item, idx) => {
                    // Normalize keys
                    const title = item['Titulo'] || item['Título'] || 'Material';
                    const link = item['Link'] || item['URL'] || '#';
                    const desc = item['Descripcion'] || item['Descripción'] || '';
                    const format = item['Formato'] || 'DOC';
                    const num = item['Numero'] || item['N°'] || idx + 1;

                    const div = document.createElement('div');
                    div.className = "doc-card bg-white border border-slate-200 rounded-2xl p-6 flex flex-col md:flex-row items-center gap-6 group relative overflow-hidden transition-all hover:shadow-lg hover:border-indigo-100";
                    div.innerHTML = `
                        <div class="absolute top-4 right-4 text-xs font-bold text-slate-200 pointer-events-none">#${num}</div>
                        <div class="w-16 h-16 bg-slate-50 text-primary rounded-2xl flex items-center justify-center shrink-0 shadow-inner group-hover:bg-primary group-hover:text-white transition-colors">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        </div>
                        <div class="flex-1 text-center md:text-left w-full">
                            <h3 class="text-xl font-bold text-slate-800 mb-1 group-hover:text-primary transition-colors">${title}</h3>
                            <div class="flex items-center justify-center md:justify-start gap-2 text-sm text-slate-500">
                                 <span class="bg-slate-100 px-2 py-0.5 rounded text-xs font-semibold uppercase">${format}</span>
                            </div>
                        </div>
                        <div class="mt-2 md:mt-0 w-full md:w-auto">
                            <a href="${link}" target="_blank" class="bg-primary text-white px-8 py-3 rounded-xl font-semibold hover:bg-blue-900 transition-colors shadow-lg shadow-blue-900/10">Ver Recurso</a>
                        </div>
                    `;
                    listEl.appendChild(div);
                });
            } else {
                listEl.innerHTML = `<div class="p-12 text-center bg-slate-50 rounded-2xl border border-dashed border-slate-200 text-slate-400">
                    <p>No hay recursos disponibles.</p>
                </div>`;
            }
        }

    </script>
</body>
</html>